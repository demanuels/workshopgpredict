<!DOCTYPE html>
 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glioma Trial Enrollment Predictor</title>
    <title>GPREDICT: Prediction of Glioma Patients' Enrollment In Therapeutic Clinical Trials</title>
    <style>
        /* General Styling */
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: auto;
            padding: 20px;
            text-align: center;
            background-color: #f5f5f5;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            text-align: left;
        }

        /* Title Styling */
        .title {
            font-size: 2em;
            font-weight: bold;
            color: #052049;
            margin-bottom: 10px;
        }

        /* Description Styling */
        .description {
            font-size: 1em;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            max-width: 90%;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.5;
        }

        /* Section Titles - UCSF Dark Blue */
        .section-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #052049; /* UCSF Dark Blue */
            margin-top: 20px;
            padding-bottom: 5px;
            border-bottom: 2px solid #052049; /* Ensure border color matches */
            text-align: left;
        }

        /* Form Inputs */
        .form-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
        }

        .form-group label {
            width: 50%;
        }

        input, select {
            padding: 8px;
            width: 50%;
            border: 1px solid #ccc;
            border-radius: 5px;
            background: #fafafa;
            box-sizing: border-box; /* Ensures same width */
        }

        /* Calculate Probability Button - UCSF Light Blue */
        button {
            padding: 12px;
            width: 100%;
            background-color: #0076cf; /* UCSF Light Blue */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
            font-size: 1em;
            font-weight: bold;
        }

        button:hover {
            background-color: #0056a4; /* Slightly Darker UCSF Blue */
        }

        /* Enrollment Probability Box */
        .result-box {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 10px;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            border: 2px solid #052049;
            width: 80%;
            margin-left: auto;
            margin-right: auto;
        }

        #resultText {
            font-size: 1.2em; /* Same as heading */
        }

        /* Toggle Buttons */
        .toggle-buttons {
            display: block; /* Change flex to block to avoid layout conflicts */
            width: 100%; /* Ensure full width */
            margin-top: 20px;
        }

        /* General Recommendations Button (100% width) */
        .toggle-button-teal {
            width: 100%; /* Ensure it spans full width */
            padding: 12px;
            background-color: #007272;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            margin: 0 auto;
        }

        .toggle-button-teal:hover {
            background-color: #005555;
        }

        /* Patient-Specific Buttons */
        .toggle-buttons.side-by-side {
            display: flex; /* Display buttons side by side */
            justify-content: space-between; /* Space out the buttons */
        }

        .toggle-button {
            width: 48%; /* Each button takes up 48% of the container's width */
            padding: 12px;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .toggle-button span {
            font-size: 1.2em;
        }

        .toggle-button-blue {
            background-color: #052049;
        }

        .toggle-button-blue:hover {
            background-color: #02152b;
        }

        .toggle-button-orange {
            background-color: #C04C00;
        }

        .toggle-button-orange:hover {
            background-color: #8a3700;
        }

        .toggle-button-teal {
            background-color: #007272;
        }

        .toggle-button-teal:hover {
            background-color: #005555;
        }

        /* Hidden Sections */
        .toggle-content {
            display: none;
            width: 100%;
            margin-top: 10px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            border: 2px solid #dcdcdc;
        }

        /* Centering Container */
        .centered-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        /* Ensure all toggle content sections have the same width */
        .toggle-content {
            width: 100%;
            max-width: 48%;  /* Ensure it matches the width of side-by-side sections */
            margin: 0 auto;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            border: 2px solid #dcdcdc;
            box-sizing: border-box;
        }
    </style>
</head>

<body>
    <h2>Glioma Clinical Trial Enrollment Predictor</h2>
    <h1 class="title">GPREDICT: Prediction of Glioma Patients' Enrollment In Therapeutic Clinical Trials</h1>
    <p class="description">GPREDICT allows clinicians and researchers to estimate individual adult glioma patients' probability of enrolling in a therapeutic clinical trial, identify which patients may face barriers to enrollment, and provide tailored recommendations to improve trial participation.</p>

    <div class="container">
        <form id="predictionForm">
            <!-- General Recommendations Button Now Above the Form -->

            <!-- DEMOGRAPHIC VARIABLES -->
            <div class="section-title">Demographic Variables</div>
            <div class="form-group">
                <label for="AgeDiagnosis">Age at Initial Diagnosis (years):</label>
                <input type="number" id="AgeDiagnosis" required>
            </div>

            <div class="form-group">
                <label for="Sex">Sex:</label>
                <select id="Sex" required>
                    <option value="1">Male</option>
                    <option value="2">Female</option>
                </select>
            </div>

            <div class="form-group">
                <label for="Race">Race:</label>
                <select id="Race" required>
                    <option value="White">White</option>
                    <option value="Black">Black/African American</option>
                    <option value="Hispanic">Hispanic/Latino</option>
                    <option value="Asian">Asian</option>
                    <option value="Pacific">Pacific Islander</option>
                    <option value="Other">Other</option>
                    <option value="Unknown">Unknown</option>
                </select>
            </div>

            <div class="form-group">
                <label for="Ethnicity">Ethnicity:</label>
                <select id="Ethnicity" required>
                    <option value="1">Hispanic/Latino</option>
                    <option value="2">Non-Hispanic/Latino</option>
                    <option value="Unknown">Unknown</option>
                </select>
            </div>

            <div class="form-group">
                <label for="PreferredLanguage">Preferred Language:</label>
                <select id="PreferredLanguage" required>
                    <option value="1">English</option>
                    <option value="2">Non-English Language</option>
                </select>
            </div>

            <!-- SOCIOECONOMIC VARIABLES -->
            <div class="section-title">Socioeconomic Variables</div>
            <div class="form-group">
                <label for="Insurance">Insurance Status at Diagnosis:</label>
                <select id="Insurance" required>
                    <option value="1">Private</option>
                    <option value="2">Medi-cal/Medicaid</option>
                    <option value="3">Medicare</option>
                    <option value="4">Unknown</option>
                    <option value="5">Self-pay</option>
                </select>
            </div>

            <div class="form-group">
                <label for="Employment">Employment Status:</label>
                <select id="Employment" required>
                    <option value="1">Employed</option>
                    <option value="2">Unemployed</option>
                    <option value="3">Retired</option>
                    <option value="Unknown">Unknown</option>
                </select>
            </div>

            <div class="form-group">
                <label for="IncomeZip">Neighborhood Median Household Income by Patient Zip Code ($): 
                    <span class="tooltip">
                        <a href="https://data.census.gov/table?q=median+household+income&tid=ACSST1Y2021.S1901" target="_blank">*</a>
                        <span class="tooltiptext">Median income was derived for neighborhood Zipcode. Click the link to determine patient's neighborhood household income by zipcode.</span>
                    </span>
                </label>
                <input type="number" id="IncomeZip" required>
            </div>

            <div class="form-group">
                <label for="DistanceHospital">Driving Distance from Patient's Home to Hospital (miles):</label>
                <input type="number" id="DistanceHospital" required>
            </div>

            <!-- ONCOLOGIC VARIABLES -->
            <div class="section-title">Oncologic Variables</div>
            <div class="form-group">
                <label for="WHOGrade">WHO Grade:</label>
                <select id="WHOGrade" required>
                    <option value="2-3">Grade 2-3</option>
                    <option value="4">Grade 4</option>
                </select>
            </div>

            <div class="form-group">
                <label for="TumorLobe">Tumor Lobe:</label>
                <select id="TumorLobe" required>
                    <option value="Frontal">Frontal</option>
                    <option value="Parietal">Parietal</option>
                    <option value="Temporal">Temporal</option>
                    <option value="Brainstem">Brainstem, Insular, Basal Ganglia, or Thalamus</option>
                    <option value="Multifocal">Multifocal</option>
                    <option value="Occipital">Occipital</option>
                    <option value="Cerebellum">Cerebellum</option>
                    <option value="Unknown">Unknown</option>
                </select>
            </div>

            <div class="form-group">
                <label for="Seizure">Seizure at Diagnosis:</label>
                <select id="Seizure" required>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                    <option value="NA">Unknown</option>
                </select>
            </div>

            <div class="form-group">
                <label for="KPSPostOp">KPS after Surgery:</label>
                <select id="KPSPostOp" required>
                    <option value="100">100</option>
                    <option value="90">90</option>
                    <option value="80">80</option>
                    <option value="<80">Less than 80</option>
                    <option value="NA">Unknown</option>
                </select>
            </div>

            <div class="form-group">
                <label for="Chemotherapy">History of Chemotherapy Use?</label>
                <select id="Chemotherapy" required>
                    <option value="1">Yes</option>
                    <option value="2">No</option>
                    <option value="Unknown">Unknown</option>
                </select>
            </div>

            <button type="button" onclick="calculateProbability()">Calculate Probability</button>
        </form>

        <h4 id="shapImpact"></h4>

        <!-- Display Probability -->
        <div id="resultBox" class="result-box">
            <h3>Estimated Enrollment Probability:</h3>
            <p id="resultText"></p> <!-- ✅ Fixed: Probability is displayed inside the gray box -->
        </div>
        <!-- General Recommendations -->
        <div class="centered-container">
            <button class="toggle-button toggle-button-teal" onclick="toggleSection('generalRecommendations')">
                General Recommendations for Trial Screening <span>▼</span>
            </button>
            <div id="generalRecommendations" class="toggle-content">
                <div class="impact-title">General Recommendations for Trial Screening</div>
                <table class="recommendation-table">
                    <thead>
                        <tr>
                            <th style="color: #052049;">Screening Discussion Patterns</th>
                            <th style="color: #C04C00;">Recommendations</th>
                        </tr>
                    </thead>
                    <tbody id="generalRecommendationTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Toggle Buttons -->
        <div class="toggle-buttons side-by-side"> <!-- Add side-by-side class -->
            <button class="toggle-button toggle-button-blue" onclick="toggleSection('impactSection')">
                Patient-Specific Characteristics Influencing Enrollment <span>▼</span>
            </button>
            <button class="toggle-button toggle-button-orange" onclick="toggleSection('patientRecommendations')">
                Patient-Specific Recommendations <span>▼</span>
            </button>
        </div>

        <!-- Impact Section -->
        <div id="impactSection" class="toggle-content">
            <div class="impact-title">Patient-Specific Characteristics That Most Influence Enrollment Probability</div>
            <table class="impact-table">
                <thead>
                    <tr>
                        <th style="color: #052049;">Factors Increasing Enrollment Probability</th>
                        <th style="color: #C04C00;">Factors Decreasing Enrollment Probability</th>
                    </tr>
                </thead>
                <tbody id="impactTableBody"></tbody>
            </table>
        </div>

        <!-- Patient-Specific Recommendations -->
        <div id="patientRecommendations" class="toggle-content">
            <div class="impact-title">Patient-Specific Recommendations</div>
            <table class="recommendation-table">
                <thead>
                    <tr>
                        <th style="color: #052049;">Patient Characteristics and Context</th>
                        <th style="color: #C04C00;">Recommendations</th>
                    </tr>
                </thead>
                <tbody id="patientRecommendationTableBody"></tbody>
            </table>
        </div>

    </div>

    <script src="jmp_score.js"></script> <!-- 📌 Ensures the model is correctly linked -->
    <script src="model.js"></script>

    <script>
        function toggleSection(sectionId) {
            var section = document.getElementById(sectionId);
            section.style.display = section.style.display === "block" ? "none" : "block";
        }

        function calculateProbability() {
            let indata = {};
            let shapImpact = [];
            let patientRecommendations = [];

            if (typeof score !== "function") {
                console.error("⚠️ ERROR: score() function is not defined. Check that model.js is properly linked.");
                document.getElementById("resultText").innerText = "Error: Model not loaded.";
                return; // Stop execution
            }

            let agept = parseFloat(document.getElementById("AgeDiagnosis").value);
            let race = document.getElementById("Race")?.value;
            console.log(`🎯 Retrieved Race Value: ${race}`);
            let ethnicity = document.getElementById("Ethnicity")?.value;
            let language = document.getElementById("PreferredLanguage")?.value;
            let insurance = document.getElementById("Insurance")?.value;
            let employment = document.getElementById("Employment")?.value;
            let income = parseFloat(document.getElementById("IncomeZip")?.value);
            let distance = parseFloat(document.getElementById("DistanceHospital")?.value);
            let kps = document.getElementById("KPSPostOp")?.value;

            console.log("🚀 Input values:", { agept, race, ethnicity, language, insurance, employment, income, distance, kps });

            if (language === "2") {
                patientRecommendations.push({
                    message: "Patients with limited or moderate English proficiency are underrepresented in clinical trials.",
                    recommendations: [
                        "It is crucial to use medical interpreters or certified bilingual providers for all clinical trial screening discussions, which focus on nuanced treatments and challenging decisions."
                    ]
                });
            }

            if (["2", "3", "5"].includes(insurance) || employment === "2" || income < 54000) {
                patientRecommendations.push({
                    message: "Under/uninsured, lower-income, and unemployed patients may not enroll due to hidden costs of enrollment (e.g., travel costs, lost wages, out-of-pocket costs).",
                    recommendations: [
                        "Collaborate with social work colleagues to ease financial burdens.",
                        "Advocate that sponsors of clinical trials anticipate and help cover unexpected costs of participation.",
                        "Create funding mechanisms for clinical trials that focus exclusively on cancer health disparities."
                    ]
                });
            }

            if (distance >= 30) {
                patientRecommendations.push({
                    message: "Patients living farther from the hospital, such as rural patients, may struggle to enroll due to transportation time and costs.",
                    recommendations: [
                        "Offer remote/home-based visits, consolidated appointments, travel vouchers, and temporary local housing options whenever possible."
                    ]
 
 
     </script>
 
 </body>
 </html>
